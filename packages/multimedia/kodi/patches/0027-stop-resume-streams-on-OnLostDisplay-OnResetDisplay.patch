From ef590549752c0b7daccb12c28d34feb5e7ed2171 Mon Sep 17 00:00:00 2001
From: Matus Kral <matuskral@me.com>
Date: Mon, 18 Jul 2016 23:34:51 +0200
Subject: [PATCH 27/37] stop/resume streams on OnLostDisplay/OnResetDisplay

---
 xbmc/cores/AudioEngine/Engines/ActiveAE/ActiveAE.cpp | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/xbmc/cores/AudioEngine/Engines/ActiveAE/ActiveAE.cpp b/xbmc/cores/AudioEngine/Engines/ActiveAE/ActiveAE.cpp
index 4f55b37..4aad146 100644
--- a/xbmc/cores/AudioEngine/Engines/ActiveAE/ActiveAE.cpp
+++ b/xbmc/cores/AudioEngine/Engines/ActiveAE/ActiveAE.cpp
@@ -2843,6 +2843,11 @@ AEAudioFormat CActiveAE::GetCurrentSinkFormat()
 void CActiveAE::OnLostDisplay()
 {
   Message *reply;
+  for(auto &&stream : m_streams)
+    m_controlPort.SendOutMessageSync(CActiveAEControlProtocol::PAUSESTREAM,
+                                                &reply, 1000,
+                                                &stream, sizeof(CActiveAEStream*));
+
   if (m_controlPort.SendOutMessageSync(CActiveAEControlProtocol::DISPLAYLOST,
                                                  &reply,
                                                  5000))
@@ -2862,7 +2867,12 @@ void CActiveAE::OnLostDisplay()
 
 void CActiveAE::OnResetDisplay()
 {
-  m_controlPort.SendOutMessage(CActiveAEControlProtocol::DISPLAYRESET);
+  Message *reply;
+  m_controlPort.SendOutMessageSync(CActiveAEControlProtocol::DISPLAYRESET, &reply, 1000);
+  for(auto &&stream : m_streams)
+    m_controlPort.SendOutMessageSync(CActiveAEControlProtocol::RESUMESTREAM,
+                                                &reply, 1000,
+                                                &stream, sizeof(CActiveAEStream*));
 }
 
 void CActiveAE::OnAppFocusChange(bool focus)
-- 
1.9.1

